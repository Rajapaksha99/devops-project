{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Kavindu\\\\Desktop\\\\ssh-project-slt\\\\frontend\\\\src\\\\pages\\\\TerminalPage.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useCallback } from \"react\";\nimport { io } from \"socket.io-client\";\nimport { Terminal } from \"xterm\";\nimport \"xterm/css/xterm.css\";\nimport { FitAddon } from 'xterm-addon-fit';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst SERVER_URL = \"http://localhost:5000\";\n\n// GLOBAL SINGLETON PATTERN - Prevent multiple instances\nlet globalTerminalInstance = null;\nlet globalSocketInstance = null;\nlet globalIsInitialized = false;\nlet globalFitAddon = null;\nlet globalInputHandler = null;\nlet globalKeyHandler = null;\nlet globalEventListenersAttached = false;\nconst TerminalPage = () => {\n  _s();\n  var _connectionData$sessi, _connectionData$serve;\n  const [isConnected, setIsConnected] = useState(false);\n  const [connectionData, setConnectionData] = useState(null);\n  const [error, setError] = useState(\"\");\n  const [connectionStatus, setConnectionStatus] = useState(\"initializing\");\n\n  // Refs that don't cause re-renders\n  const terminalRef = useRef();\n  const terminalInstance = useRef();\n  const socketRef = useRef();\n  const isInitializedRef = useRef(false);\n  const connectionTimeoutRef = useRef(null);\n  const getStoredUserData = useCallback(() => {\n    try {\n      const userData = localStorage.getItem('user');\n      const token = localStorage.getItem('token');\n      if (userData) {\n        const user = JSON.parse(userData);\n        return {\n          token: token || '',\n          userId: user.id || user._id || '',\n          userEmail: user.email || '',\n          userName: user.name || '',\n          registeredId: user.registered_id || '',\n          userRole: user.role || 'student'\n        };\n      }\n    } catch (err) {\n      console.warn(\"Could not retrieve stored user data:\", err);\n    }\n    return {};\n  }, []);\n  const connectToSSHServer = useCallback((socketInstance, data, term) => {\n    if (!socketInstance || !data || !term) {\n      console.error(\"Missing socket instance, connection data, or terminal\");\n      if (term) term.write(`❌ Cannot connect: Missing connection data\\r\\n`);\n      return;\n    }\n    console.log(\"🔗 Attempting SSH connection with data:\", data);\n    const sshConnectionData = {\n      host: data.host,\n      username: data.username,\n      password: data.password,\n      port: data.port || 22,\n      user: {\n        id: data.userId,\n        name: data.userName,\n        email: data.userEmail,\n        registered_id: data.registeredId,\n        role: data.userRole\n      },\n      session: {\n        id: data.sessionId,\n        token: data.token,\n        connectionTime: data.connectionTime,\n        serverName: data.serverName,\n        dashboardUrl: data.dashboardUrl,\n        serverId: data.serverId\n      },\n      browser: {\n        userAgent: data.browserInfo || navigator.userAgent,\n        windowId: window.name,\n        referrer: document.referrer\n      }\n    };\n    term.write(`🔗 Connecting to SSH server...\\r\\n`);\n    term.write(`📡 Host: ${data.host}:${data.port || 22}\\r\\n`);\n    term.write(`👤 User: ${data.username}\\r\\n`);\n    term.write(`🔐 Authenticating...\\r\\n\\r\\n`);\n    console.log(\"📤 Sending SSH connection data:\", sshConnectionData);\n\n    // Send connection request - only once\n    socketInstance.emit(\"ssh-connect\", sshConnectionData);\n    socketInstance.emit(\"user-activity\", {\n      type: 'terminal_access',\n      userId: data.userId,\n      userName: data.userName,\n      action: 'ssh_connect_attempt',\n      target: data.host,\n      timestamp: new Date().toISOString(),\n      sessionId: data.sessionId,\n      serverId: data.serverId\n    });\n\n    // Clear any existing timeout\n    if (connectionTimeoutRef.current) {\n      clearTimeout(connectionTimeoutRef.current);\n    }\n\n    // Set timeout warning\n    connectionTimeoutRef.current = setTimeout(() => {\n      term.write(`⏱️ Connection is taking longer than expected...\\r\\n`);\n      term.write(`💡 Check if your backend server is handling SSH connections properly\\r\\n\\r\\n`);\n    }, 10000);\n  }, []);\n  const cleanupConnection = useCallback(() => {\n    console.log(\"🧹 GLOBAL CLEANUP: Cleaning up connection...\");\n\n    // Clear timeout\n    if (connectionTimeoutRef.current) {\n      clearTimeout(connectionTimeoutRef.current);\n      connectionTimeoutRef.current = null;\n    }\n\n    // Clean up global input handlers\n    if (globalInputHandler) {\n      console.log(\"🗑️ Disposing GLOBAL input handler...\");\n      globalInputHandler.dispose();\n      globalInputHandler = null;\n    }\n    if (globalKeyHandler) {\n      console.log(\"🗑️ Disposing GLOBAL key handler...\");\n      globalKeyHandler.dispose();\n      globalKeyHandler = null;\n    }\n\n    // Clean up global socket\n    if (globalSocketInstance) {\n      console.log(\"🗑️ Cleaning up GLOBAL socket...\");\n      globalSocketInstance.removeAllListeners();\n      globalSocketInstance.disconnect();\n      globalSocketInstance = null;\n    }\n\n    // Clean up global terminal\n    if (globalTerminalInstance && !globalTerminalInstance.isDisposed) {\n      console.log(\"🗑️ Disposing GLOBAL terminal...\");\n      globalTerminalInstance.dispose();\n      globalTerminalInstance = null;\n    }\n\n    // Reset global flags\n    globalIsInitialized = false;\n    globalFitAddon = null;\n    globalEventListenersAttached = false;\n\n    // Clean up session storage\n    Object.keys(sessionStorage).forEach(key => {\n      if (key.startsWith('terminal_')) {\n        sessionStorage.removeItem(key);\n      }\n    });\n    console.log(\"✅ GLOBAL cleanup complete\");\n  }, []);\n  const setupSocketEventListeners = useCallback((socket, term, data) => {\n    // Prevent multiple event listener attachments\n    if (globalEventListenersAttached) {\n      console.log(\"🛑 Socket event listeners already attached globally, skipping...\");\n      return;\n    }\n    console.log(\"🎧 Setting up socket event listeners (ONCE)...\");\n    globalEventListenersAttached = true;\n    let sshConnectedHandled = false;\n    socket.on(\"connect\", () => {\n      console.log(\"✅ GLOBAL SOCKET: Connected to terminal server\");\n      setIsConnected(true);\n      setConnectionStatus(\"connected\");\n      term.write(`✅ Socket connected to ${SERVER_URL}\\r\\n`);\n      term.write(`🔗 Establishing SSH connection...\\r\\n\\r\\n`);\n      connectToSSHServer(socket, data, term);\n    });\n    socket.on(\"ssh-output\", outputData => {\n      if (term && !term.isDisposed) {\n        term.write(outputData);\n      }\n    });\n    socket.on(\"ssh-connected\", info => {\n      // PREVENT DUPLICATE SSH CONNECTED MESSAGES\n      if (sshConnectedHandled) {\n        console.log(\"⚠️ SSH connected event already handled globally, ignoring duplicate\");\n        return;\n      }\n      sshConnectedHandled = true;\n\n      // Clear timeout\n      if (connectionTimeoutRef.current) {\n        clearTimeout(connectionTimeoutRef.current);\n        connectionTimeoutRef.current = null;\n      }\n      console.log(\"🎉 GLOBAL SSH: Connection established (ONCE ONLY)\");\n      setConnectionStatus(\"ssh-connected\");\n      setError(\"\");\n      term.write(`\\r\\n🎉 SSH CONNECTION ESTABLISHED! 🎉\\r\\n`);\n      term.write(`✅ Connected to: ${info.host || data.host}\\r\\n`);\n      term.write(`👤 User: ${data.userName || 'Unknown'}\\r\\n`);\n      term.write(`🆔 ID: ${data.registeredId || 'No ID'}\\r\\n`);\n      term.write(`⏰ Time: ${new Date().toLocaleString()}\\r\\n`);\n      term.write(`${'='.repeat(50)}\\r\\n`);\n      term.write(`💡 You can now run commands like: pwd, ls, whoami\\r\\n`);\n      term.write(`${'='.repeat(50)}\\r\\n\\r\\n`);\n    });\n    socket.on(\"ssh-error\", errorData => {\n      const errorMsg = errorData.message || errorData;\n      term.write(`\\r\\n❌ SSH Connection Error: ${errorMsg}\\r\\n`);\n      term.write(`\\r\\n🔄 Retrying connection in 3 seconds...\\r\\n`);\n      setConnectionStatus(\"error\");\n      setError(errorMsg);\n      setTimeout(() => {\n        if (globalSocketInstance && data) {\n          connectToSSHServer(globalSocketInstance, data, term);\n        }\n      }, 3000);\n    });\n    socket.on(\"ssh-disconnected\", () => {\n      term.write(\"\\r\\n🔌 SSH connection closed\\r\\n\");\n      setConnectionStatus(\"disconnected\");\n      setIsConnected(false);\n    });\n    socket.on(\"disconnect\", reason => {\n      setIsConnected(false);\n      setConnectionStatus(\"disconnected\");\n      term.write(`\\r\\n[Socket disconnected: ${reason}]\\r\\n`);\n      if (reason !== 'io client disconnect') {\n        setTimeout(() => {\n          if (globalSocketInstance && !globalSocketInstance.connected) {\n            term.write(`\\r\\n🔄 Attempting to reconnect...\\r\\n`);\n            globalSocketInstance.connect();\n          }\n        }, 2000);\n      }\n    });\n    socket.on(\"connect_error\", err => {\n      const errorMsg = `Connection error: ${err.message}`;\n      setError(errorMsg);\n      setConnectionStatus(\"error\");\n      term.write(`\\r\\n❌ ${errorMsg}\\r\\n`);\n      term.write(`\\r\\n💡 Make sure your backend server is running on ${SERVER_URL}\\r\\n`);\n    });\n  }, [connectToSSHServer]);\n  const setupTerminalInputHandlers = useCallback((term, socket) => {\n    // Dispose any existing GLOBAL handlers first\n    if (globalInputHandler) {\n      globalInputHandler.dispose();\n      globalInputHandler = null;\n      console.log(\"🗑️ Disposed existing GLOBAL input handler\");\n    }\n    if (globalKeyHandler) {\n      globalKeyHandler.dispose();\n      globalKeyHandler = null;\n      console.log(\"🗑️ Disposed existing GLOBAL key handler\");\n    }\n    console.log(\"🎯 Setting up terminal input handlers (ONCE)...\");\n\n    // GLOBAL INPUT HANDLER - Attach only once globally\n    globalInputHandler = term.onData(input => {\n      console.log(\"🎯 GLOBAL INPUT (single handler):\", JSON.stringify(input));\n      if (socket && socket.connected) {\n        // Send raw input without any local echo\n        socket.emit(\"ssh-input\", input);\n        console.log(\"📤 GLOBAL SEND (single emit):\", JSON.stringify(input));\n      } else {\n        term.write(`\\r\\n❌ Not connected to server. Cannot send input.\\r\\n`);\n      }\n    });\n\n    // GLOBAL KEY HANDLER - Only for special keys like Ctrl+C\n    globalKeyHandler = term.onKey(({\n      key,\n      domEvent\n    }) => {\n      // Only handle Ctrl+C specifically, nothing else\n      if (domEvent.ctrlKey && domEvent.key === 'c') {\n        if (socket && socket.connected) {\n          socket.emit(\"ssh-input\", '\\x03'); // Send interrupt signal\n          console.log(\"📤 GLOBAL CTRL+C sent\");\n        }\n      }\n      // DON'T handle any other keys to prevent duplication\n    });\n    console.log(\"✅ Terminal input handlers set up successfully\");\n  }, []);\n  const initializeTerminal = useCallback(data => {\n    // GLOBAL SINGLETON CHECK - Prevent multiple instances across ALL React renders\n    if (globalIsInitialized) {\n      console.log(\"🛑 GLOBAL BLOCK: Terminal already exists globally, using existing instance\");\n\n      // If we have existing global instances, just update refs and state\n      if (globalTerminalInstance && terminalRef.current && !globalTerminalInstance.isDisposed) {\n        var _globalSocketInstance, _globalSocketInstance2;\n        terminalInstance.current = globalTerminalInstance;\n        socketRef.current = globalSocketInstance;\n        setIsConnected(!!((_globalSocketInstance = globalSocketInstance) !== null && _globalSocketInstance !== void 0 && _globalSocketInstance.connected));\n        setConnectionStatus((_globalSocketInstance2 = globalSocketInstance) !== null && _globalSocketInstance2 !== void 0 && _globalSocketInstance2.connected ? \"ssh-connected\" : \"connected\");\n      }\n      return;\n    }\n    console.log(\"🚀 GLOBAL INIT: Creating SINGLE terminal instance globally\");\n    globalIsInitialized = true; // Set GLOBAL flag immediately\n    isInitializedRef.current = true; // Set local flag too\n    setConnectionStatus(\"connecting\");\n\n    // Create GLOBAL fitAddon only once\n    if (!globalFitAddon) {\n      globalFitAddon = new FitAddon();\n    }\n\n    // Initialize Terminal with DISABLED local echo\n    const term = new Terminal({\n      cursorBlink: true,\n      theme: {\n        background: '#000000',\n        foreground: '#ffffff',\n        cursor: '#ffffff',\n        selection: '#ffffff40',\n        black: '#000000',\n        red: '#e74c3c',\n        green: '#2ecc71',\n        yellow: '#f1c40f',\n        blue: '#3498db',\n        magenta: '#9b59b6',\n        cyan: '#1abc9c',\n        white: '#ecf0f1'\n      },\n      fontSize: 14,\n      fontFamily: 'Consolas, Monaco, \"Courier New\", monospace',\n      rows: 30,\n      cols: 120,\n      scrollback: 1000,\n      convertEol: true,\n      disableStdin: false,\n      localEcho: false // No local echo\n    });\n    term.loadAddon(globalFitAddon);\n    if (terminalRef.current) {\n      term.open(terminalRef.current);\n\n      // Fit terminal after a small delay to ensure proper rendering\n      setTimeout(() => {\n        if (globalFitAddon && !term.isDisposed) {\n          try {\n            globalFitAddon.fit();\n          } catch (err) {\n            console.warn(\"Initial fit error:\", err);\n          }\n        }\n      }, 100);\n\n      // Set GLOBAL references\n      globalTerminalInstance = term;\n      terminalInstance.current = term;\n      term.write('🚀 GLOBAL TERMINAL: Initializing (ONCE)...\\r\\n');\n      term.write(`📡 Connecting to ${SERVER_URL}...\\r\\n\\r\\n`);\n    }\n\n    // Clean up existing GLOBAL socket before creating new one\n    if (globalSocketInstance) {\n      globalSocketInstance.removeAllListeners();\n      globalSocketInstance.disconnect();\n    }\n\n    // Initialize Socket.IO as GLOBAL instance\n    const newSocket = io(SERVER_URL, {\n      query: {\n        userId: data.userId || '',\n        userName: data.userName || '',\n        userRole: data.userRole || 'student'\n      },\n      timeout: 10000,\n      forceNew: true,\n      reconnection: true,\n      reconnectionAttempts: 5,\n      reconnectionDelay: 1000,\n      transports: ['websocket', 'polling'] // Ensure proper transport\n    });\n\n    // Set GLOBAL socket reference\n    globalSocketInstance = newSocket;\n    socketRef.current = newSocket;\n\n    // Setup event listeners (only once)\n    setupSocketEventListeners(newSocket, term, data);\n\n    // Setup input handlers (only once)\n    setupTerminalInputHandlers(newSocket, term);\n\n    // Handle window resize - using GLOBAL ref to prevent recreation\n    const handleResize = () => {\n      if (term && term.element && globalFitAddon && !term.isDisposed) {\n        try {\n          globalFitAddon.fit();\n        } catch (fitError) {\n          console.warn(\"Fit error:\", fitError);\n          // Fallback resize logic\n          if (terminalRef.current) {\n            const cols = Math.floor(terminalRef.current.clientWidth / 9);\n            const rows = Math.floor(terminalRef.current.clientHeight / 17);\n            term.resize(cols, rows);\n          }\n        }\n      }\n    };\n    window.addEventListener('resize', handleResize);\n\n    // Return cleanup function\n    return () => {\n      console.log(\"🧹 Local cleanup function called...\");\n      window.removeEventListener('resize', handleResize);\n\n      // Don't clean up global instances here - only in cleanupConnection\n      // Just remove local references\n      terminalInstance.current = null;\n      socketRef.current = null;\n    };\n  }, [setupSocketEventListeners, setupTerminalInputHandlers]);\n  const parseConnectionData = useCallback(rawData => {\n    console.log(\"🔍 Parsing connection data:\", rawData);\n    const storedUserData = getStoredUserData();\n\n    // Create normalized connection data structure\n    const normalizedData = {\n      // Server connection details - handle both direct and nested structures\n      host: rawData.host || rawData.ip || '',\n      username: rawData.username || '',\n      password: rawData.password || '',\n      port: rawData.port || 22,\n      serverName: rawData.serverName || rawData.name || rawData.host || 'Unknown Server',\n      // User data with fallbacks\n      userId: rawData.userId || storedUserData.userId || '',\n      userName: rawData.userName || storedUserData.userName || '',\n      userEmail: rawData.userEmail || storedUserData.userEmail || '',\n      registeredId: rawData.registeredId || storedUserData.registeredId || '',\n      userRole: rawData.userRole || storedUserData.userRole || 'student',\n      // Session data\n      token: rawData.token || storedUserData.token || '',\n      sessionId: rawData.sessionId || `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      connectionTime: rawData.connectionTime || new Date().toISOString(),\n      // Additional metadata\n      dashboardUrl: rawData.dashboardUrl || window.location.origin,\n      browserInfo: rawData.browserInfo || navigator.userAgent,\n      serverId: rawData.serverId || rawData.id || rawData._id || '',\n      // Support for nested user structure from API\n      user: rawData.user || {\n        id: rawData.userId || storedUserData.userId,\n        name: rawData.userName || storedUserData.userName,\n        email: rawData.userEmail || storedUserData.userEmail,\n        registered_id: rawData.registeredId || storedUserData.registeredId,\n        role: rawData.userRole || storedUserData.userRole || 'student'\n      }\n    };\n    console.log(\"✅ Normalized connection data:\", normalizedData);\n    return normalizedData;\n  }, [getStoredUserData]);\n  const initializeConnection = useCallback(() => {\n    // Prevent multiple initializations\n    if (isInitializedRef.current) {\n      console.log(\"Connection already initialized, skipping...\");\n      return;\n    }\n    try {\n      const urlParams = new URLSearchParams(window.location.search);\n      let data = null;\n\n      // Method 1: SessionKey approach (most secure)\n      const sessionKey = urlParams.get('sessionKey');\n      if (sessionKey) {\n        console.log(\"🔑 Using sessionKey method:\", sessionKey);\n        const sessionData = sessionStorage.getItem(sessionKey);\n        if (sessionData) {\n          data = JSON.parse(sessionData);\n          sessionStorage.removeItem(sessionKey);\n          console.log(\"📦 Retrieved data from sessionStorage:\", data);\n        }\n      }\n\n      // Method 2: Direct URL data (fallback)\n      if (!data) {\n        const urlData = urlParams.get('data') || urlParams.get('fallbackData');\n        if (urlData) {\n          console.log(\"🔗 Using URL data method\");\n          data = JSON.parse(decodeURIComponent(urlData));\n        }\n      }\n\n      // Method 3: Individual URL parameters (legacy compatibility)\n      if (!data) {\n        console.log(\"🔄 Using individual URL parameters (legacy)\");\n        const host = urlParams.get('host');\n        const username = urlParams.get('username');\n        const password = urlParams.get('password');\n        const serverName = urlParams.get('serverName') || urlParams.get('name');\n        const token = urlParams.get('token');\n        const userId = urlParams.get('userId');\n        const serverId = urlParams.get('serverId');\n        if (host && username && password) {\n          data = {\n            host,\n            username,\n            password,\n            serverName,\n            token,\n            userId,\n            serverId,\n            ...getStoredUserData()\n          };\n        }\n      }\n\n      // Method 4: SessionStorage fallback\n      if (!data) {\n        console.log(\"💾 Checking sessionStorage fallback\");\n        const stored = sessionStorage.getItem('terminalConnection');\n        if (stored) {\n          data = JSON.parse(stored);\n        }\n      }\n      if (data) {\n        console.log(\"✅ Raw connection data found:\", data);\n        const normalizedData = parseConnectionData(data);\n\n        // Validate required fields\n        if (!normalizedData.host || !normalizedData.username || !normalizedData.password) {\n          throw new Error(\"Missing required connection parameters: host, username, or password\");\n        }\n        setConnectionData(normalizedData);\n      } else {\n        setError(\"No connection data provided. Please return to the dashboard and try again.\");\n        console.error(\"❌ No connection data found through any method\");\n      }\n    } catch (err) {\n      console.error(\"❌ Error initializing connection:\", err);\n      setError(`Failed to initialize connection data: ${err.message}`);\n    }\n  }, [getStoredUserData, parseConnectionData]);\n\n  // Separate useEffect for initial connection data loading - NO DEPENDENCIES\n  useEffect(() => {\n    if (!isInitializedRef.current) {\n      console.log(\"🔄 Loading initial connection data (ONCE)...\");\n      initializeConnection();\n    }\n  }, []); // COMPLETELY EMPTY - run only once on mount\n\n  // Separate useEffect for terminal initialization - NO DEPENDENCIES  \n  useEffect(() => {\n    if (connectionData && !globalIsInitialized) {\n      console.log(\"🚀 GLOBAL CHECK: Initializing terminal with connection data (ONCE)...\");\n      const cleanup = initializeTerminal(connectionData);\n      return cleanup;\n    } else if (connectionData && globalIsInitialized) {\n      console.log(\"🔄 GLOBAL EXISTS: Connecting to existing terminal instance\");\n      // Connect to existing global terminal\n      if (globalTerminalInstance && terminalRef.current && !globalTerminalInstance.isDisposed) {\n        try {\n          var _globalSocketInstance3, _globalSocketInstance4;\n          globalTerminalInstance.open(terminalRef.current);\n          terminalInstance.current = globalTerminalInstance;\n          socketRef.current = globalSocketInstance;\n          setIsConnected(!!((_globalSocketInstance3 = globalSocketInstance) !== null && _globalSocketInstance3 !== void 0 && _globalSocketInstance3.connected));\n          setConnectionStatus((_globalSocketInstance4 = globalSocketInstance) !== null && _globalSocketInstance4 !== void 0 && _globalSocketInstance4.connected ? \"ssh-connected\" : \"connected\");\n        } catch (err) {\n          console.error(\"Error reconnecting to existing terminal:\", err);\n        }\n      }\n    }\n  }, [connectionData, initializeTerminal]);\n\n  // Handle postMessage communication\n  useEffect(() => {\n    const handleMessage = event => {\n      if (event.data && event.data.type === 'TERMINAL_CONNECTION_DATA') {\n        if (!isInitializedRef.current) {\n          console.log(\"📨 Received postMessage data:\", event.data.data);\n          const normalizedData = parseConnectionData(event.data.data);\n          setConnectionData(normalizedData);\n        }\n      }\n    };\n    window.addEventListener('message', handleMessage);\n    return () => {\n      window.removeEventListener('message', handleMessage);\n    };\n  }, [parseConnectionData]);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      console.log(\"Component unmounting, cleaning up...\");\n      cleanupConnection();\n    };\n  }, [cleanupConnection]);\n  const handleDisconnect = useCallback(() => {\n    if (globalSocketInstance) {\n      globalSocketInstance.emit(\"user-disconnect\", {\n        userId: connectionData === null || connectionData === void 0 ? void 0 : connectionData.userId,\n        userName: connectionData === null || connectionData === void 0 ? void 0 : connectionData.userName,\n        sessionId: connectionData === null || connectionData === void 0 ? void 0 : connectionData.sessionId,\n        serverId: connectionData === null || connectionData === void 0 ? void 0 : connectionData.serverId,\n        disconnectTime: new Date().toISOString(),\n        disconnectReason: 'user_initiated'\n      });\n      globalSocketInstance.disconnect();\n    }\n    cleanupConnection();\n    window.close();\n  }, [connectionData, cleanupConnection]);\n  const handleReconnect = useCallback(() => {\n    if (connectionData) {\n      console.log(\"🔄 Starting reconnection process...\");\n      setError(\"\");\n      setConnectionStatus(\"reconnecting\");\n\n      // CRITICAL: Clean up ALL global handlers first\n      if (globalInputHandler) {\n        globalInputHandler.dispose();\n        globalInputHandler = null;\n        console.log(\"✅ Input handler disposed for reconnect\");\n      }\n      if (globalKeyHandler) {\n        globalKeyHandler.dispose();\n        globalKeyHandler = null;\n        console.log(\"✅ Key handler disposed for reconnect\");\n      }\n\n      // Reset initialization flags BEFORE cleanup\n      globalIsInitialized = false;\n      globalEventListenersAttached = false;\n      isInitializedRef.current = false;\n      if (globalTerminalInstance && !globalTerminalInstance.isDisposed) {\n        globalTerminalInstance.clear();\n        globalTerminalInstance.write(\"🔄 Reconnecting...\\r\\n\");\n      }\n\n      // Clean up existing connection\n      if (globalSocketInstance) {\n        globalSocketInstance.removeAllListeners();\n        globalSocketInstance.disconnect();\n        globalSocketInstance = null;\n      }\n      if (globalTerminalInstance) {\n        globalTerminalInstance.dispose();\n        globalTerminalInstance = null;\n      }\n\n      // Reinitialize after cleanup with delay\n      setTimeout(() => {\n        console.log(\"🔄 Reinitializing terminal after cleanup...\");\n        initializeTerminal(connectionData);\n      }, 1000);\n    }\n  }, [connectionData, initializeTerminal]);\n  const handleNewSession = useCallback(() => {\n    if (globalTerminalInstance && !globalTerminalInstance.isDisposed) {\n      globalTerminalInstance.clear();\n    }\n    if (globalSocketInstance && connectionData) {\n      const newSessionData = {\n        ...connectionData,\n        sessionId: `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        connectionTime: new Date().toISOString()\n      };\n      setConnectionData(newSessionData);\n      connectToSSHServer(globalSocketInstance, newSessionData, globalTerminalInstance);\n    }\n  }, [connectionData, connectToSSHServer]);\n  const handleNewTerminal = useCallback(() => {\n    handleNewSession();\n  }, [handleNewSession]);\n  const getStatusColor = () => {\n    switch (connectionStatus) {\n      case \"connected\":\n      case \"ssh-connected\":\n        return \"#2ecc71\";\n      case \"connecting\":\n      case \"reconnecting\":\n        return \"#f39c12\";\n      case \"error\":\n        return \"#e74c3c\";\n      default:\n        return \"#95a5a6\";\n    }\n  };\n  const getStatusText = () => {\n    switch (connectionStatus) {\n      case \"initializing\":\n        return \"Initializing...\";\n      case \"connecting\":\n        return \"Connecting...\";\n      case \"connected\":\n        return \"Socket Connected\";\n      case \"ssh-connected\":\n        return \"SSH Connected\";\n      case \"reconnecting\":\n        return \"Reconnecting...\";\n      case \"disconnected\":\n        return \"Disconnected\";\n      case \"error\":\n        return \"Connection Error\";\n      default:\n        return \"Unknown\";\n    }\n  };\n  const getUserDisplayInfo = () => {\n    if (!connectionData) return {\n      name: 'Unknown',\n      id: 'N/A',\n      email: 'N/A'\n    };\n    return {\n      name: connectionData.userName || 'Unknown',\n      id: connectionData.registeredId || 'N/A',\n      email: connectionData.userEmail || 'N/A',\n      role: connectionData.userRole || 'student'\n    };\n  };\n  if (error && !connectionData) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        height: '100vh',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        backgroundColor: '#2c3e50',\n        color: 'white',\n        fontFamily: 'Arial, sans-serif'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          textAlign: 'center',\n          padding: '40px',\n          backgroundColor: '#34495e',\n          borderRadius: '8px',\n          maxWidth: '500px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: '48px',\n            marginBottom: '20px'\n          },\n          children: \"\\u26A0\\uFE0F\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 796,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          style: {\n            margin: '0 0 15px 0'\n          },\n          children: \"Loading Terminal...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 797,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            margin: '0 0 20px 0',\n            color: '#bdc3c7'\n          },\n          children: \"Initializing connection data...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 798,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            marginTop: '20px'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleReconnect,\n            style: {\n              padding: '10px 20px',\n              backgroundColor: '#3498db',\n              color: 'white',\n              border: 'none',\n              borderRadius: '4px',\n              cursor: 'pointer',\n              fontSize: '14px'\n            },\n            children: \"\\uD83D\\uDD04 Retry Connection\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 800,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 799,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 789,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 780,\n      columnNumber: 7\n    }, this);\n  }\n  const userInfo = getUserDisplayInfo();\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      height: '100vh',\n      display: 'flex',\n      flexDirection: 'column',\n      backgroundColor: '#2c3e50'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        padding: '12px 20px',\n        backgroundColor: '#34495e',\n        color: 'white',\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center',\n        borderBottom: '2px solid #2c3e50',\n        minHeight: '60px'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          flex: 1\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            alignItems: 'center',\n            gap: '15px'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            style: {\n              margin: 0,\n              fontSize: '18px',\n              fontWeight: 'bold'\n            },\n            children: [\"\\uD83D\\uDDA5\\uFE0F \", (connectionData === null || connectionData === void 0 ? void 0 : connectionData.serverName) || (connectionData === null || connectionData === void 0 ? void 0 : connectionData.host) || \"Terminal\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 837,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: 'flex',\n              alignItems: 'center',\n              gap: '6px',\n              padding: '4px 8px',\n              backgroundColor: getStatusColor(),\n              borderRadius: '12px',\n              fontSize: '12px'\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                width: '8px',\n                height: '8px',\n                borderRadius: '50%',\n                backgroundColor: 'white'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 849,\n              columnNumber: 15\n            }, this), getStatusText()]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 840,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 836,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: '13px',\n            color: '#bdc3c7',\n            marginTop: '4px'\n          },\n          children: [\"\\uD83D\\uDC64 \", userInfo.name, userInfo.id !== 'N/A' && ` (ID: ${userInfo.id})`, userInfo.email !== 'N/A' && ` | 📧 ${userInfo.email}`, connectionData && ` | 🔗 ${connectionData.username}@${connectionData.host}`]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 859,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 835,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          gap: '8px'\n        },\n        children: [(connectionStatus === \"error\" || connectionStatus === \"disconnected\") && /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleReconnect,\n          style: {\n            padding: '6px 12px',\n            backgroundColor: '#f39c12',\n            color: 'white',\n            border: 'none',\n            borderRadius: '4px',\n            cursor: 'pointer',\n            fontSize: '12px'\n          },\n          children: \"\\uD83D\\uDD04 Reconnect\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 869,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleNewTerminal,\n          style: {\n            padding: '6px 12px',\n            backgroundColor: '#3498db',\n            color: 'white',\n            border: 'none',\n            borderRadius: '4px',\n            cursor: 'pointer',\n            fontSize: '12px'\n          },\n          children: \"\\uD83C\\uDD95 New Session\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 885,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleDisconnect,\n          style: {\n            padding: '6px 12px',\n            backgroundColor: '#e74c3c',\n            color: 'white',\n            border: 'none',\n            borderRadius: '4px',\n            cursor: 'pointer',\n            fontSize: '12px'\n          },\n          children: \"\\u274C Disconnect & Close\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 900,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 867,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 825,\n      columnNumber: 7\n    }, this), connectionData && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        padding: '8px 20px',\n        backgroundColor: '#2c3e50',\n        color: '#ecf0f1',\n        fontSize: '12px',\n        borderBottom: '1px solid #34495e'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'center'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [\"\\uD83C\\uDF10 Server: \", connectionData.host, \" | \\uD83D\\uDC65 Role: \", userInfo.role, \" | \\uD83D\\uDD11 Session: \", ((_connectionData$sessi = connectionData.sessionId) === null || _connectionData$sessi === void 0 ? void 0 : _connectionData$sessi.substr(-8)) || 'N/A', \" | \\uD83C\\uDD94 Server ID: \", ((_connectionData$serve = connectionData.serverId) === null || _connectionData$serve === void 0 ? void 0 : _connectionData$serve.substr(-8)) || 'N/A']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 927,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: connectionData.connectionTime && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [\"Connected: \", new Date(connectionData.connectionTime).toLocaleTimeString()]\n          }, void 0, true)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 933,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 926,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 919,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        padding: '4px 20px',\n        backgroundColor: '#1a252f',\n        color: '#95a5a6',\n        fontSize: '11px',\n        borderBottom: '1px solid #34495e'\n      },\n      children: [\"\\uD83D\\uDD0D Debug: Socket URL: \", SERVER_URL, \" | Status: \", connectionStatus, \" | Connected: \", isConnected ? 'Yes' : 'No', \" | GLOBAL Instance: \", globalIsInitialized ? 'ACTIVE' : 'NONE', \" | Event Listeners: \", globalEventListenersAttached ? 'ATTACHED' : 'NONE', \" | Input Handler: \", globalInputHandler ? 'ACTIVE' : 'NONE', \" | Server Data: \", connectionData ? 'LOADED' : 'MISSING', \" |\", error && ` Error: ${error}`]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 943,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: terminalRef,\n      style: {\n        flex: 1,\n        padding: '10px',\n        backgroundColor: '#000000',\n        overflow: 'hidden',\n        border: '1px solid #34495e',\n        margin: '5px'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 960,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        padding: '8px 20px',\n        backgroundColor: '#34495e',\n        color: '#bdc3c7',\n        fontSize: '11px',\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: error ? /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            color: '#e74c3c'\n          },\n          children: [\"\\u274C Error: \", error]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 984,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"Terminal ready | Use Ctrl+C to interrupt | Type 'exit' to close SSH session | No Local Echo\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 986,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 982,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [userInfo.name !== 'Unknown' && `Logged in as: ${userInfo.name}`, (connectionData === null || connectionData === void 0 ? void 0 : connectionData.serverId) && ` | Server: ${connectionData.serverName}`]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 991,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 973,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 823,\n    columnNumber: 5\n  }, this);\n};\n_s(TerminalPage, \"P/oBs80od78UkWTeGxTjrRIsezM=\");\n_c = TerminalPage;\nexport default TerminalPage;\nvar _c;\n$RefreshReg$(_c, \"TerminalPage\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","io","Terminal","FitAddon","jsxDEV","_jsxDEV","Fragment","_Fragment","SERVER_URL","globalTerminalInstance","globalSocketInstance","globalIsInitialized","globalFitAddon","globalInputHandler","globalKeyHandler","globalEventListenersAttached","TerminalPage","_s","_connectionData$sessi","_connectionData$serve","isConnected","setIsConnected","connectionData","setConnectionData","error","setError","connectionStatus","setConnectionStatus","terminalRef","terminalInstance","socketRef","isInitializedRef","connectionTimeoutRef","getStoredUserData","userData","localStorage","getItem","token","user","JSON","parse","userId","id","_id","userEmail","email","userName","name","registeredId","registered_id","userRole","role","err","console","warn","connectToSSHServer","socketInstance","data","term","write","log","sshConnectionData","host","username","password","port","session","sessionId","connectionTime","serverName","dashboardUrl","serverId","browser","userAgent","browserInfo","navigator","windowId","window","referrer","document","emit","type","action","target","timestamp","Date","toISOString","current","clearTimeout","setTimeout","cleanupConnection","dispose","removeAllListeners","disconnect","isDisposed","Object","keys","sessionStorage","forEach","key","startsWith","removeItem","setupSocketEventListeners","socket","sshConnectedHandled","on","outputData","info","toLocaleString","repeat","errorData","errorMsg","message","reason","connected","connect","setupTerminalInputHandlers","onData","input","stringify","onKey","domEvent","ctrlKey","initializeTerminal","_globalSocketInstance","_globalSocketInstance2","cursorBlink","theme","background","foreground","cursor","selection","black","red","green","yellow","blue","magenta","cyan","white","fontSize","fontFamily","rows","cols","scrollback","convertEol","disableStdin","localEcho","loadAddon","open","fit","newSocket","query","timeout","forceNew","reconnection","reconnectionAttempts","reconnectionDelay","transports","handleResize","element","fitError","Math","floor","clientWidth","clientHeight","resize","addEventListener","removeEventListener","parseConnectionData","rawData","storedUserData","normalizedData","ip","now","random","toString","substr","location","origin","initializeConnection","urlParams","URLSearchParams","search","sessionKey","get","sessionData","urlData","decodeURIComponent","stored","Error","cleanup","_globalSocketInstance3","_globalSocketInstance4","handleMessage","event","handleDisconnect","disconnectTime","disconnectReason","close","handleReconnect","clear","handleNewSession","newSessionData","handleNewTerminal","getStatusColor","getStatusText","getUserDisplayInfo","style","height","display","alignItems","justifyContent","backgroundColor","color","children","textAlign","padding","borderRadius","maxWidth","marginBottom","fileName","_jsxFileName","lineNumber","columnNumber","margin","marginTop","onClick","border","userInfo","flexDirection","borderBottom","minHeight","flex","gap","fontWeight","width","toLocaleTimeString","ref","overflow","_c","$RefreshReg$"],"sources":["C:/Users/Kavindu/Desktop/ssh-project-slt/frontend/src/pages/TerminalPage.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from \"react\";\r\nimport { io } from \"socket.io-client\";\r\nimport { Terminal } from \"xterm\";\r\nimport \"xterm/css/xterm.css\";\r\nimport { FitAddon } from 'xterm-addon-fit';\r\n\r\nconst SERVER_URL = \"http://localhost:5000\";\r\n\r\n// GLOBAL SINGLETON PATTERN - Prevent multiple instances\r\nlet globalTerminalInstance = null;\r\nlet globalSocketInstance = null;\r\nlet globalIsInitialized = false;\r\nlet globalFitAddon = null;\r\nlet globalInputHandler = null;\r\nlet globalKeyHandler = null;\r\nlet globalEventListenersAttached = false;\r\n\r\nconst TerminalPage = () => {\r\n  const [isConnected, setIsConnected] = useState(false);\r\n  const [connectionData, setConnectionData] = useState(null);\r\n  const [error, setError] = useState(\"\");\r\n  const [connectionStatus, setConnectionStatus] = useState(\"initializing\");\r\n  \r\n  // Refs that don't cause re-renders\r\n  const terminalRef = useRef();\r\n  const terminalInstance = useRef();\r\n  const socketRef = useRef();\r\n  const isInitializedRef = useRef(false);\r\n  const connectionTimeoutRef = useRef(null);\r\n\r\n  const getStoredUserData = useCallback(() => {\r\n    try {\r\n      const userData = localStorage.getItem('user');\r\n      const token = localStorage.getItem('token');\r\n      \r\n      if (userData) {\r\n        const user = JSON.parse(userData);\r\n        return {\r\n          token: token || '',\r\n          userId: user.id || user._id || '',\r\n          userEmail: user.email || '',\r\n          userName: user.name || '',\r\n          registeredId: user.registered_id || '',\r\n          userRole: user.role || 'student'\r\n        };\r\n      }\r\n    } catch (err) {\r\n      console.warn(\"Could not retrieve stored user data:\", err);\r\n    }\r\n    return {};\r\n  }, []);\r\n\r\n  const connectToSSHServer = useCallback((socketInstance, data, term) => {\r\n    if (!socketInstance || !data || !term) {\r\n      console.error(\"Missing socket instance, connection data, or terminal\");\r\n      if (term) term.write(`❌ Cannot connect: Missing connection data\\r\\n`);\r\n      return;\r\n    }\r\n\r\n    console.log(\"🔗 Attempting SSH connection with data:\", data);\r\n\r\n    const sshConnectionData = {\r\n      host: data.host,\r\n      username: data.username,\r\n      password: data.password,\r\n      port: data.port || 22,\r\n      \r\n      user: {\r\n        id: data.userId,\r\n        name: data.userName,\r\n        email: data.userEmail,\r\n        registered_id: data.registeredId,\r\n        role: data.userRole\r\n      },\r\n      \r\n      session: {\r\n        id: data.sessionId,\r\n        token: data.token,\r\n        connectionTime: data.connectionTime,\r\n        serverName: data.serverName,\r\n        dashboardUrl: data.dashboardUrl,\r\n        serverId: data.serverId\r\n      },\r\n      \r\n      browser: {\r\n        userAgent: data.browserInfo || navigator.userAgent,\r\n        windowId: window.name,\r\n        referrer: document.referrer\r\n      }\r\n    };\r\n\r\n    term.write(`🔗 Connecting to SSH server...\\r\\n`);\r\n    term.write(`📡 Host: ${data.host}:${data.port || 22}\\r\\n`);\r\n    term.write(`👤 User: ${data.username}\\r\\n`);\r\n    term.write(`🔐 Authenticating...\\r\\n\\r\\n`);\r\n\r\n    console.log(\"📤 Sending SSH connection data:\", sshConnectionData);\r\n\r\n    // Send connection request - only once\r\n    socketInstance.emit(\"ssh-connect\", sshConnectionData);\r\n    \r\n    socketInstance.emit(\"user-activity\", {\r\n      type: 'terminal_access',\r\n      userId: data.userId,\r\n      userName: data.userName,\r\n      action: 'ssh_connect_attempt',\r\n      target: data.host,\r\n      timestamp: new Date().toISOString(),\r\n      sessionId: data.sessionId,\r\n      serverId: data.serverId\r\n    });\r\n\r\n    // Clear any existing timeout\r\n    if (connectionTimeoutRef.current) {\r\n      clearTimeout(connectionTimeoutRef.current);\r\n    }\r\n\r\n    // Set timeout warning\r\n    connectionTimeoutRef.current = setTimeout(() => {\r\n      term.write(`⏱️ Connection is taking longer than expected...\\r\\n`);\r\n      term.write(`💡 Check if your backend server is handling SSH connections properly\\r\\n\\r\\n`);\r\n    }, 10000);\r\n\r\n  }, []);\r\n\r\n  const cleanupConnection = useCallback(() => {\r\n    console.log(\"🧹 GLOBAL CLEANUP: Cleaning up connection...\");\r\n    \r\n    // Clear timeout\r\n    if (connectionTimeoutRef.current) {\r\n      clearTimeout(connectionTimeoutRef.current);\r\n      connectionTimeoutRef.current = null;\r\n    }\r\n    \r\n    // Clean up global input handlers\r\n    if (globalInputHandler) {\r\n      console.log(\"🗑️ Disposing GLOBAL input handler...\");\r\n      globalInputHandler.dispose();\r\n      globalInputHandler = null;\r\n    }\r\n    if (globalKeyHandler) {\r\n      console.log(\"🗑️ Disposing GLOBAL key handler...\");\r\n      globalKeyHandler.dispose();\r\n      globalKeyHandler = null;\r\n    }\r\n    \r\n    // Clean up global socket\r\n    if (globalSocketInstance) {\r\n      console.log(\"🗑️ Cleaning up GLOBAL socket...\");\r\n      globalSocketInstance.removeAllListeners();\r\n      globalSocketInstance.disconnect();\r\n      globalSocketInstance = null;\r\n    }\r\n    \r\n    // Clean up global terminal\r\n    if (globalTerminalInstance && !globalTerminalInstance.isDisposed) {\r\n      console.log(\"🗑️ Disposing GLOBAL terminal...\");\r\n      globalTerminalInstance.dispose();\r\n      globalTerminalInstance = null;\r\n    }\r\n    \r\n    // Reset global flags\r\n    globalIsInitialized = false;\r\n    globalFitAddon = null;\r\n    globalEventListenersAttached = false;\r\n    \r\n    // Clean up session storage\r\n    Object.keys(sessionStorage).forEach(key => {\r\n      if (key.startsWith('terminal_')) {\r\n        sessionStorage.removeItem(key);\r\n      }\r\n    });\r\n    \r\n    console.log(\"✅ GLOBAL cleanup complete\");\r\n  }, []);\r\n\r\n  const setupSocketEventListeners = useCallback((socket, term, data) => {\r\n    // Prevent multiple event listener attachments\r\n    if (globalEventListenersAttached) {\r\n      console.log(\"🛑 Socket event listeners already attached globally, skipping...\");\r\n      return;\r\n    }\r\n\r\n    console.log(\"🎧 Setting up socket event listeners (ONCE)...\");\r\n    globalEventListenersAttached = true;\r\n\r\n    let sshConnectedHandled = false;\r\n\r\n    socket.on(\"connect\", () => {\r\n      console.log(\"✅ GLOBAL SOCKET: Connected to terminal server\");\r\n      setIsConnected(true);\r\n      setConnectionStatus(\"connected\");\r\n      term.write(`✅ Socket connected to ${SERVER_URL}\\r\\n`);\r\n      term.write(`🔗 Establishing SSH connection...\\r\\n\\r\\n`);\r\n      \r\n      connectToSSHServer(socket, data, term);\r\n    });\r\n\r\n    socket.on(\"ssh-output\", (outputData) => {\r\n      if (term && !term.isDisposed) {\r\n        term.write(outputData);\r\n      }\r\n    });\r\n\r\n    socket.on(\"ssh-connected\", (info) => {\r\n      // PREVENT DUPLICATE SSH CONNECTED MESSAGES\r\n      if (sshConnectedHandled) {\r\n        console.log(\"⚠️ SSH connected event already handled globally, ignoring duplicate\");\r\n        return;\r\n      }\r\n      sshConnectedHandled = true;\r\n      \r\n      // Clear timeout\r\n      if (connectionTimeoutRef.current) {\r\n        clearTimeout(connectionTimeoutRef.current);\r\n        connectionTimeoutRef.current = null;\r\n      }\r\n      \r\n      console.log(\"🎉 GLOBAL SSH: Connection established (ONCE ONLY)\");\r\n      setConnectionStatus(\"ssh-connected\");\r\n      setError(\"\");\r\n      term.write(`\\r\\n🎉 SSH CONNECTION ESTABLISHED! 🎉\\r\\n`);\r\n      term.write(`✅ Connected to: ${info.host || data.host}\\r\\n`);\r\n      term.write(`👤 User: ${data.userName || 'Unknown'}\\r\\n`);\r\n      term.write(`🆔 ID: ${data.registeredId || 'No ID'}\\r\\n`);\r\n      term.write(`⏰ Time: ${new Date().toLocaleString()}\\r\\n`);\r\n      term.write(`${'='.repeat(50)}\\r\\n`);\r\n      term.write(`💡 You can now run commands like: pwd, ls, whoami\\r\\n`);\r\n      term.write(`${'='.repeat(50)}\\r\\n\\r\\n`);\r\n    });\r\n\r\n    socket.on(\"ssh-error\", (errorData) => {\r\n      const errorMsg = errorData.message || errorData;\r\n      term.write(`\\r\\n❌ SSH Connection Error: ${errorMsg}\\r\\n`);\r\n      term.write(`\\r\\n🔄 Retrying connection in 3 seconds...\\r\\n`);\r\n      setConnectionStatus(\"error\");\r\n      setError(errorMsg);\r\n      \r\n      setTimeout(() => {\r\n        if (globalSocketInstance && data) {\r\n          connectToSSHServer(globalSocketInstance, data, term);\r\n        }\r\n      }, 3000);\r\n    });\r\n\r\n    socket.on(\"ssh-disconnected\", () => {\r\n      term.write(\"\\r\\n🔌 SSH connection closed\\r\\n\");\r\n      setConnectionStatus(\"disconnected\");\r\n      setIsConnected(false);\r\n    });\r\n\r\n    socket.on(\"disconnect\", (reason) => {\r\n      setIsConnected(false);\r\n      setConnectionStatus(\"disconnected\");\r\n      term.write(`\\r\\n[Socket disconnected: ${reason}]\\r\\n`);\r\n      \r\n      if (reason !== 'io client disconnect') {\r\n        setTimeout(() => {\r\n          if (globalSocketInstance && !globalSocketInstance.connected) {\r\n            term.write(`\\r\\n🔄 Attempting to reconnect...\\r\\n`);\r\n            globalSocketInstance.connect();\r\n          }\r\n        }, 2000);\r\n      }\r\n    });\r\n\r\n    socket.on(\"connect_error\", (err) => {\r\n      const errorMsg = `Connection error: ${err.message}`;\r\n      setError(errorMsg);\r\n      setConnectionStatus(\"error\");\r\n      term.write(`\\r\\n❌ ${errorMsg}\\r\\n`);\r\n      term.write(`\\r\\n💡 Make sure your backend server is running on ${SERVER_URL}\\r\\n`);\r\n    });\r\n  }, [connectToSSHServer]);\r\n\r\n  const setupTerminalInputHandlers = useCallback((term, socket) => {\r\n    // Dispose any existing GLOBAL handlers first\r\n    if (globalInputHandler) {\r\n      globalInputHandler.dispose();\r\n      globalInputHandler = null;\r\n      console.log(\"🗑️ Disposed existing GLOBAL input handler\");\r\n    }\r\n    if (globalKeyHandler) {\r\n      globalKeyHandler.dispose();\r\n      globalKeyHandler = null;\r\n      console.log(\"🗑️ Disposed existing GLOBAL key handler\");\r\n    }\r\n\r\n    console.log(\"🎯 Setting up terminal input handlers (ONCE)...\");\r\n\r\n    // GLOBAL INPUT HANDLER - Attach only once globally\r\n    globalInputHandler = term.onData((input) => {\r\n      console.log(\"🎯 GLOBAL INPUT (single handler):\", JSON.stringify(input));\r\n      if (socket && socket.connected) {\r\n        // Send raw input without any local echo\r\n        socket.emit(\"ssh-input\", input);\r\n        console.log(\"📤 GLOBAL SEND (single emit):\", JSON.stringify(input));\r\n      } else {\r\n        term.write(`\\r\\n❌ Not connected to server. Cannot send input.\\r\\n`);\r\n      }\r\n    });\r\n\r\n    // GLOBAL KEY HANDLER - Only for special keys like Ctrl+C\r\n    globalKeyHandler = term.onKey(({ key, domEvent }) => {\r\n      // Only handle Ctrl+C specifically, nothing else\r\n      if (domEvent.ctrlKey && domEvent.key === 'c') {\r\n        if (socket && socket.connected) {\r\n          socket.emit(\"ssh-input\", '\\x03'); // Send interrupt signal\r\n          console.log(\"📤 GLOBAL CTRL+C sent\");\r\n        }\r\n      }\r\n      // DON'T handle any other keys to prevent duplication\r\n    });\r\n\r\n    console.log(\"✅ Terminal input handlers set up successfully\");\r\n  }, []);\r\n\r\n  const initializeTerminal = useCallback((data) => {\r\n    // GLOBAL SINGLETON CHECK - Prevent multiple instances across ALL React renders\r\n    if (globalIsInitialized) {\r\n      console.log(\"🛑 GLOBAL BLOCK: Terminal already exists globally, using existing instance\");\r\n      \r\n      // If we have existing global instances, just update refs and state\r\n      if (globalTerminalInstance && terminalRef.current && !globalTerminalInstance.isDisposed) {\r\n        terminalInstance.current = globalTerminalInstance;\r\n        socketRef.current = globalSocketInstance;\r\n        setIsConnected(!!globalSocketInstance?.connected);\r\n        setConnectionStatus(globalSocketInstance?.connected ? \"ssh-connected\" : \"connected\");\r\n      }\r\n      return;\r\n    }\r\n    \r\n    console.log(\"🚀 GLOBAL INIT: Creating SINGLE terminal instance globally\");\r\n    globalIsInitialized = true; // Set GLOBAL flag immediately\r\n    isInitializedRef.current = true; // Set local flag too\r\n    setConnectionStatus(\"connecting\");\r\n    \r\n    // Create GLOBAL fitAddon only once\r\n    if (!globalFitAddon) {\r\n      globalFitAddon = new FitAddon();\r\n    }\r\n    \r\n    // Initialize Terminal with DISABLED local echo\r\n    const term = new Terminal({\r\n      cursorBlink: true,\r\n      theme: {\r\n        background: '#000000',\r\n        foreground: '#ffffff',\r\n        cursor: '#ffffff',\r\n        selection: '#ffffff40',\r\n        black: '#000000',\r\n        red: '#e74c3c',\r\n        green: '#2ecc71',\r\n        yellow: '#f1c40f',\r\n        blue: '#3498db',\r\n        magenta: '#9b59b6',\r\n        cyan: '#1abc9c',\r\n        white: '#ecf0f1'\r\n      },\r\n      fontSize: 14,\r\n      fontFamily: 'Consolas, Monaco, \"Courier New\", monospace',\r\n      rows: 30,\r\n      cols: 120,\r\n      scrollback: 1000,\r\n      convertEol: true,\r\n      disableStdin: false,\r\n      localEcho: false // No local echo\r\n    });\r\n\r\n    term.loadAddon(globalFitAddon);\r\n\r\n    if (terminalRef.current) {\r\n      term.open(terminalRef.current);\r\n      \r\n      // Fit terminal after a small delay to ensure proper rendering\r\n      setTimeout(() => {\r\n        if (globalFitAddon && !term.isDisposed) {\r\n          try {\r\n            globalFitAddon.fit();\r\n          } catch (err) {\r\n            console.warn(\"Initial fit error:\", err);\r\n          }\r\n        }\r\n      }, 100);\r\n      \r\n      // Set GLOBAL references\r\n      globalTerminalInstance = term;\r\n      terminalInstance.current = term;\r\n      \r\n      term.write('🚀 GLOBAL TERMINAL: Initializing (ONCE)...\\r\\n');\r\n      term.write(`📡 Connecting to ${SERVER_URL}...\\r\\n\\r\\n`);\r\n    }\r\n    \r\n    // Clean up existing GLOBAL socket before creating new one\r\n    if (globalSocketInstance) {\r\n      globalSocketInstance.removeAllListeners();\r\n      globalSocketInstance.disconnect();\r\n    }\r\n    \r\n    // Initialize Socket.IO as GLOBAL instance\r\n    const newSocket = io(SERVER_URL, {\r\n      query: {\r\n        userId: data.userId || '',\r\n        userName: data.userName || '',\r\n        userRole: data.userRole || 'student'\r\n      },\r\n      timeout: 10000,\r\n      forceNew: true,\r\n      reconnection: true,\r\n      reconnectionAttempts: 5,\r\n      reconnectionDelay: 1000,\r\n      transports: ['websocket', 'polling'] // Ensure proper transport\r\n    });\r\n    \r\n    // Set GLOBAL socket reference\r\n    globalSocketInstance = newSocket;\r\n    socketRef.current = newSocket;\r\n\r\n    // Setup event listeners (only once)\r\n    setupSocketEventListeners(newSocket, term, data);\r\n    \r\n    // Setup input handlers (only once)\r\n    setupTerminalInputHandlers(newSocket, term);\r\n\r\n    // Handle window resize - using GLOBAL ref to prevent recreation\r\n    const handleResize = () => {\r\n      if (term && term.element && globalFitAddon && !term.isDisposed) {\r\n        try {\r\n          globalFitAddon.fit();\r\n        } catch (fitError) {\r\n          console.warn(\"Fit error:\", fitError);\r\n          // Fallback resize logic\r\n          if (terminalRef.current) {\r\n            const cols = Math.floor(terminalRef.current.clientWidth / 9);\r\n            const rows = Math.floor(terminalRef.current.clientHeight / 17);\r\n            term.resize(cols, rows);\r\n          }\r\n        }\r\n      }\r\n    };\r\n    \r\n    window.addEventListener('resize', handleResize);\r\n\r\n    // Return cleanup function\r\n    return () => {\r\n      console.log(\"🧹 Local cleanup function called...\");\r\n      window.removeEventListener('resize', handleResize);\r\n      \r\n      // Don't clean up global instances here - only in cleanupConnection\r\n      // Just remove local references\r\n      terminalInstance.current = null;\r\n      socketRef.current = null;\r\n    };\r\n  }, [setupSocketEventListeners, setupTerminalInputHandlers]);\r\n\r\n  const parseConnectionData = useCallback((rawData) => {\r\n    console.log(\"🔍 Parsing connection data:\", rawData);\r\n    \r\n    const storedUserData = getStoredUserData();\r\n    \r\n    // Create normalized connection data structure\r\n    const normalizedData = {\r\n      // Server connection details - handle both direct and nested structures\r\n      host: rawData.host || rawData.ip || '',\r\n      username: rawData.username || '',\r\n      password: rawData.password || '',\r\n      port: rawData.port || 22,\r\n      serverName: rawData.serverName || rawData.name || rawData.host || 'Unknown Server',\r\n      \r\n      // User data with fallbacks\r\n      userId: rawData.userId || storedUserData.userId || '',\r\n      userName: rawData.userName || storedUserData.userName || '',\r\n      userEmail: rawData.userEmail || storedUserData.userEmail || '',\r\n      registeredId: rawData.registeredId || storedUserData.registeredId || '',\r\n      userRole: rawData.userRole || storedUserData.userRole || 'student',\r\n      \r\n      // Session data\r\n      token: rawData.token || storedUserData.token || '',\r\n      sessionId: rawData.sessionId || `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n      connectionTime: rawData.connectionTime || new Date().toISOString(),\r\n      \r\n      // Additional metadata\r\n      dashboardUrl: rawData.dashboardUrl || window.location.origin,\r\n      browserInfo: rawData.browserInfo || navigator.userAgent,\r\n      serverId: rawData.serverId || rawData.id || rawData._id || '',\r\n      \r\n      // Support for nested user structure from API\r\n      user: rawData.user || {\r\n        id: rawData.userId || storedUserData.userId,\r\n        name: rawData.userName || storedUserData.userName,\r\n        email: rawData.userEmail || storedUserData.userEmail,\r\n        registered_id: rawData.registeredId || storedUserData.registeredId,\r\n        role: rawData.userRole || storedUserData.userRole || 'student'\r\n      }\r\n    };\r\n\r\n    console.log(\"✅ Normalized connection data:\", normalizedData);\r\n    return normalizedData;\r\n  }, [getStoredUserData]);\r\n\r\n  const initializeConnection = useCallback(() => {\r\n    // Prevent multiple initializations\r\n    if (isInitializedRef.current) {\r\n      console.log(\"Connection already initialized, skipping...\");\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const urlParams = new URLSearchParams(window.location.search);\r\n      let data = null;\r\n\r\n      // Method 1: SessionKey approach (most secure)\r\n      const sessionKey = urlParams.get('sessionKey');\r\n      if (sessionKey) {\r\n        console.log(\"🔑 Using sessionKey method:\", sessionKey);\r\n        const sessionData = sessionStorage.getItem(sessionKey);\r\n        if (sessionData) {\r\n          data = JSON.parse(sessionData);\r\n          sessionStorage.removeItem(sessionKey);\r\n          console.log(\"📦 Retrieved data from sessionStorage:\", data);\r\n        }\r\n      }\r\n\r\n      // Method 2: Direct URL data (fallback)\r\n      if (!data) {\r\n        const urlData = urlParams.get('data') || urlParams.get('fallbackData');\r\n        if (urlData) {\r\n          console.log(\"🔗 Using URL data method\");\r\n          data = JSON.parse(decodeURIComponent(urlData));\r\n        }\r\n      }\r\n\r\n      // Method 3: Individual URL parameters (legacy compatibility)\r\n      if (!data) {\r\n        console.log(\"🔄 Using individual URL parameters (legacy)\");\r\n        const host = urlParams.get('host');\r\n        const username = urlParams.get('username');\r\n        const password = urlParams.get('password');\r\n        const serverName = urlParams.get('serverName') || urlParams.get('name');\r\n        const token = urlParams.get('token');\r\n        const userId = urlParams.get('userId');\r\n        const serverId = urlParams.get('serverId');\r\n\r\n        if (host && username && password) {\r\n          data = {\r\n            host,\r\n            username,\r\n            password,\r\n            serverName,\r\n            token,\r\n            userId,\r\n            serverId,\r\n            ...getStoredUserData()\r\n          };\r\n        }\r\n      }\r\n\r\n      // Method 4: SessionStorage fallback\r\n      if (!data) {\r\n        console.log(\"💾 Checking sessionStorage fallback\");\r\n        const stored = sessionStorage.getItem('terminalConnection');\r\n        if (stored) {\r\n          data = JSON.parse(stored);\r\n        }\r\n      }\r\n\r\n      if (data) {\r\n        console.log(\"✅ Raw connection data found:\", data);\r\n        const normalizedData = parseConnectionData(data);\r\n        \r\n        // Validate required fields\r\n        if (!normalizedData.host || !normalizedData.username || !normalizedData.password) {\r\n          throw new Error(\"Missing required connection parameters: host, username, or password\");\r\n        }\r\n        \r\n        setConnectionData(normalizedData);\r\n      } else {\r\n        setError(\"No connection data provided. Please return to the dashboard and try again.\");\r\n        console.error(\"❌ No connection data found through any method\");\r\n      }\r\n    } catch (err) {\r\n      console.error(\"❌ Error initializing connection:\", err);\r\n      setError(`Failed to initialize connection data: ${err.message}`);\r\n    }\r\n  }, [getStoredUserData, parseConnectionData]);\r\n\r\n  // Separate useEffect for initial connection data loading - NO DEPENDENCIES\r\n  useEffect(() => {\r\n    if (!isInitializedRef.current) {\r\n      console.log(\"🔄 Loading initial connection data (ONCE)...\");\r\n      initializeConnection();\r\n    }\r\n  }, []); // COMPLETELY EMPTY - run only once on mount\r\n\r\n  // Separate useEffect for terminal initialization - NO DEPENDENCIES  \r\n  useEffect(() => {\r\n    if (connectionData && !globalIsInitialized) {\r\n      console.log(\"🚀 GLOBAL CHECK: Initializing terminal with connection data (ONCE)...\");\r\n      const cleanup = initializeTerminal(connectionData);\r\n      \r\n      return cleanup;\r\n    } else if (connectionData && globalIsInitialized) {\r\n      console.log(\"🔄 GLOBAL EXISTS: Connecting to existing terminal instance\");\r\n      // Connect to existing global terminal\r\n      if (globalTerminalInstance && terminalRef.current && !globalTerminalInstance.isDisposed) {\r\n        try {\r\n          globalTerminalInstance.open(terminalRef.current);\r\n          terminalInstance.current = globalTerminalInstance;\r\n          socketRef.current = globalSocketInstance;\r\n          setIsConnected(!!globalSocketInstance?.connected);\r\n          setConnectionStatus(globalSocketInstance?.connected ? \"ssh-connected\" : \"connected\");\r\n        } catch (err) {\r\n          console.error(\"Error reconnecting to existing terminal:\", err);\r\n        }\r\n      }\r\n    }\r\n  }, [connectionData, initializeTerminal]);\r\n\r\n  // Handle postMessage communication\r\n  useEffect(() => {\r\n    const handleMessage = (event) => {\r\n      if (event.data && event.data.type === 'TERMINAL_CONNECTION_DATA') {\r\n        if (!isInitializedRef.current) {\r\n          console.log(\"📨 Received postMessage data:\", event.data.data);\r\n          const normalizedData = parseConnectionData(event.data.data);\r\n          setConnectionData(normalizedData);\r\n        }\r\n      }\r\n    };\r\n    \r\n    window.addEventListener('message', handleMessage);\r\n    \r\n    return () => {\r\n      window.removeEventListener('message', handleMessage);\r\n    };\r\n  }, [parseConnectionData]);\r\n\r\n  // Cleanup on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      console.log(\"Component unmounting, cleaning up...\");\r\n      cleanupConnection();\r\n    };\r\n  }, [cleanupConnection]);\r\n\r\n  const handleDisconnect = useCallback(() => {\r\n    if (globalSocketInstance) {\r\n      globalSocketInstance.emit(\"user-disconnect\", {\r\n        userId: connectionData?.userId,\r\n        userName: connectionData?.userName,\r\n        sessionId: connectionData?.sessionId,\r\n        serverId: connectionData?.serverId,\r\n        disconnectTime: new Date().toISOString(),\r\n        disconnectReason: 'user_initiated'\r\n      });\r\n      \r\n      globalSocketInstance.disconnect();\r\n    }\r\n    \r\n    cleanupConnection();\r\n    window.close();\r\n  }, [connectionData, cleanupConnection]);\r\n\r\n  const handleReconnect = useCallback(() => {\r\n    if (connectionData) {\r\n      console.log(\"🔄 Starting reconnection process...\");\r\n      setError(\"\");\r\n      setConnectionStatus(\"reconnecting\");\r\n      \r\n      // CRITICAL: Clean up ALL global handlers first\r\n      if (globalInputHandler) {\r\n        globalInputHandler.dispose();\r\n        globalInputHandler = null;\r\n        console.log(\"✅ Input handler disposed for reconnect\");\r\n      }\r\n      if (globalKeyHandler) {\r\n        globalKeyHandler.dispose();\r\n        globalKeyHandler = null;\r\n        console.log(\"✅ Key handler disposed for reconnect\");\r\n      }\r\n      \r\n      // Reset initialization flags BEFORE cleanup\r\n      globalIsInitialized = false;\r\n      globalEventListenersAttached = false;\r\n      isInitializedRef.current = false;\r\n      \r\n      if (globalTerminalInstance && !globalTerminalInstance.isDisposed) {\r\n        globalTerminalInstance.clear();\r\n        globalTerminalInstance.write(\"🔄 Reconnecting...\\r\\n\");\r\n      }\r\n      \r\n      // Clean up existing connection\r\n      if (globalSocketInstance) {\r\n        globalSocketInstance.removeAllListeners();\r\n        globalSocketInstance.disconnect();\r\n        globalSocketInstance = null;\r\n      }\r\n      \r\n      if (globalTerminalInstance) {\r\n        globalTerminalInstance.dispose();\r\n        globalTerminalInstance = null;\r\n      }\r\n      \r\n      // Reinitialize after cleanup with delay\r\n      setTimeout(() => {\r\n        console.log(\"🔄 Reinitializing terminal after cleanup...\");\r\n        initializeTerminal(connectionData);\r\n      }, 1000);\r\n    }\r\n  }, [connectionData, initializeTerminal]);\r\n\r\n  const handleNewSession = useCallback(() => {\r\n    if (globalTerminalInstance && !globalTerminalInstance.isDisposed) {\r\n      globalTerminalInstance.clear();\r\n    }\r\n    if (globalSocketInstance && connectionData) {\r\n      const newSessionData = {\r\n        ...connectionData,\r\n        sessionId: `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n        connectionTime: new Date().toISOString()\r\n      };\r\n      setConnectionData(newSessionData);\r\n      connectToSSHServer(globalSocketInstance, newSessionData, globalTerminalInstance);\r\n    }\r\n  }, [connectionData, connectToSSHServer]);\r\n\r\n  const handleNewTerminal = useCallback(() => {\r\n    handleNewSession();\r\n  }, [handleNewSession]);\r\n\r\n  const getStatusColor = () => {\r\n    switch (connectionStatus) {\r\n      case \"connected\":\r\n      case \"ssh-connected\":\r\n        return \"#2ecc71\";\r\n      case \"connecting\":\r\n      case \"reconnecting\":\r\n        return \"#f39c12\";\r\n      case \"error\":\r\n        return \"#e74c3c\";\r\n      default:\r\n        return \"#95a5a6\";\r\n    }\r\n  };\r\n\r\n  const getStatusText = () => {\r\n    switch (connectionStatus) {\r\n      case \"initializing\":\r\n        return \"Initializing...\";\r\n      case \"connecting\":\r\n        return \"Connecting...\";\r\n      case \"connected\":\r\n        return \"Socket Connected\";\r\n      case \"ssh-connected\":\r\n        return \"SSH Connected\";\r\n      case \"reconnecting\":\r\n        return \"Reconnecting...\";\r\n      case \"disconnected\":\r\n        return \"Disconnected\";\r\n      case \"error\":\r\n        return \"Connection Error\";\r\n      default:\r\n        return \"Unknown\";\r\n    }\r\n  };\r\n\r\n  const getUserDisplayInfo = () => {\r\n    if (!connectionData) return { name: 'Unknown', id: 'N/A', email: 'N/A' };\r\n    \r\n    return {\r\n      name: connectionData.userName || 'Unknown',\r\n      id: connectionData.registeredId || 'N/A',\r\n      email: connectionData.userEmail || 'N/A',\r\n      role: connectionData.userRole || 'student'\r\n    };\r\n  };\r\n\r\n  if (error && !connectionData) {\r\n    return (\r\n      <div style={{ \r\n        height: '100vh', \r\n        display: 'flex', \r\n        alignItems: 'center', \r\n        justifyContent: 'center',\r\n        backgroundColor: '#2c3e50',\r\n        color: 'white',\r\n        fontFamily: 'Arial, sans-serif'\r\n      }}>\r\n        <div style={{ \r\n          textAlign: 'center', \r\n          padding: '40px',\r\n          backgroundColor: '#34495e',\r\n          borderRadius: '8px',\r\n          maxWidth: '500px'\r\n        }}>\r\n          <div style={{ fontSize: '48px', marginBottom: '20px' }}>⚠️</div>\r\n          <h2 style={{ margin: '0 0 15px 0' }}>Loading Terminal...</h2>\r\n          <p style={{ margin: '0 0 20px 0', color: '#bdc3c7' }}>Initializing connection data...</p>\r\n          <div style={{ marginTop: '20px' }}>\r\n            <button \r\n              onClick={handleReconnect}\r\n              style={{\r\n                padding: '10px 20px',\r\n                backgroundColor: '#3498db',\r\n                color: 'white',\r\n                border: 'none',\r\n                borderRadius: '4px',\r\n                cursor: 'pointer',\r\n                fontSize: '14px'\r\n              }}\r\n            >\r\n              🔄 Retry Connection\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const userInfo = getUserDisplayInfo();\r\n\r\n  return (\r\n    <div style={{ height: '100vh', display: 'flex', flexDirection: 'column', backgroundColor: '#2c3e50' }}>\r\n      {/* Enhanced Header with User Info */}\r\n      <div style={{ \r\n        padding: '12px 20px', \r\n        backgroundColor: '#34495e', \r\n        color: 'white',\r\n        display: 'flex',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center',\r\n        borderBottom: '2px solid #2c3e50',\r\n        minHeight: '60px'\r\n      }}>\r\n        <div style={{ flex: 1 }}>\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>\r\n            <h3 style={{ margin: 0, fontSize: '18px', fontWeight: 'bold' }}>\r\n              🖥️ {connectionData?.serverName || connectionData?.host || \"Terminal\"}\r\n            </h3>\r\n            <div style={{ \r\n              display: 'flex', \r\n              alignItems: 'center', \r\n              gap: '6px',\r\n              padding: '4px 8px',\r\n              backgroundColor: getStatusColor(),\r\n              borderRadius: '12px',\r\n              fontSize: '12px'\r\n            }}>\r\n              <div style={{ \r\n                width: '8px', \r\n                height: '8px', \r\n                borderRadius: '50%', \r\n                backgroundColor: 'white' \r\n              }}></div>\r\n              {getStatusText()}\r\n            </div>\r\n          </div>\r\n          \r\n          <div style={{ fontSize: '13px', color: '#bdc3c7', marginTop: '4px' }}>\r\n            👤 {userInfo.name} \r\n            {userInfo.id !== 'N/A' && ` (ID: ${userInfo.id})`}\r\n            {userInfo.email !== 'N/A' && ` | 📧 ${userInfo.email}`}\r\n            {connectionData && ` | 🔗 ${connectionData.username}@${connectionData.host}`}\r\n          </div>\r\n        </div>\r\n\r\n        <div style={{ display: 'flex', gap: '8px' }}>\r\n          {(connectionStatus === \"error\" || connectionStatus === \"disconnected\") && (\r\n            <button \r\n              onClick={handleReconnect}\r\n              style={{\r\n                padding: '6px 12px',\r\n                backgroundColor: '#f39c12',\r\n                color: 'white',\r\n                border: 'none',\r\n                borderRadius: '4px',\r\n                cursor: 'pointer',\r\n                fontSize: '12px'\r\n              }}\r\n            >\r\n              🔄 Reconnect\r\n            </button>\r\n          )}\r\n          \r\n          <button \r\n            onClick={handleNewTerminal}\r\n            style={{\r\n              padding: '6px 12px',\r\n              backgroundColor: '#3498db',\r\n              color: 'white',\r\n              border: 'none',\r\n              borderRadius: '4px',\r\n              cursor: 'pointer',\r\n              fontSize: '12px'\r\n            }}\r\n          >\r\n            🆕 New Session\r\n          </button>\r\n          \r\n          <button \r\n            onClick={handleDisconnect}\r\n            style={{\r\n              padding: '6px 12px',\r\n              backgroundColor: '#e74c3c',\r\n              color: 'white',\r\n              border: 'none',\r\n              borderRadius: '4px',\r\n              cursor: 'pointer',\r\n              fontSize: '12px'\r\n            }}\r\n          >\r\n            ❌ Disconnect & Close\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Connection Info Bar */}\r\n      {connectionData && (\r\n        <div style={{ \r\n          padding: '8px 20px', \r\n          backgroundColor: '#2c3e50', \r\n          color: '#ecf0f1',\r\n          fontSize: '12px',\r\n          borderBottom: '1px solid #34495e'\r\n        }}>\r\n          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n            <div>\r\n              🌐 Server: {connectionData.host} | \r\n              👥 Role: {userInfo.role} | \r\n              🔑 Session: {connectionData.sessionId?.substr(-8) || 'N/A'} |\r\n              🆔 Server ID: {connectionData.serverId?.substr(-8) || 'N/A'}\r\n            </div>\r\n            <div>\r\n              {connectionData.connectionTime && (\r\n                <>Connected: {new Date(connectionData.connectionTime).toLocaleTimeString()}</>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Debug Info Bar */}\r\n      <div style={{ \r\n        padding: '4px 20px', \r\n        backgroundColor: '#1a252f', \r\n        color: '#95a5a6',\r\n        fontSize: '11px',\r\n        borderBottom: '1px solid #34495e'\r\n      }}>\r\n        🔍 Debug: Socket URL: {SERVER_URL} | Status: {connectionStatus} | \r\n        Connected: {isConnected ? 'Yes' : 'No'} | \r\n        GLOBAL Instance: {globalIsInitialized ? 'ACTIVE' : 'NONE'} | \r\n        Event Listeners: {globalEventListenersAttached ? 'ATTACHED' : 'NONE'} | \r\n        Input Handler: {globalInputHandler ? 'ACTIVE' : 'NONE'} |\r\n        Server Data: {connectionData ? 'LOADED' : 'MISSING'} |\r\n        {error && ` Error: ${error}`}\r\n      </div>\r\n\r\n      {/* Terminal Container */}\r\n      <div \r\n        ref={terminalRef} \r\n        style={{ \r\n          flex: 1, \r\n          padding: '10px',\r\n          backgroundColor: '#000000',\r\n          overflow: 'hidden',\r\n          border: '1px solid #34495e',\r\n          margin: '5px'\r\n        }} \r\n      />\r\n\r\n      {/* Status Footer */}\r\n      <div style={{ \r\n        padding: '8px 20px', \r\n        backgroundColor: '#34495e', \r\n        color: '#bdc3c7',\r\n        fontSize: '11px',\r\n        display: 'flex',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center'\r\n      }}>\r\n        <div>\r\n          {error ? (\r\n            <span style={{ color: '#e74c3c' }}>❌ Error: {error}</span>\r\n          ) : (\r\n            <span>\r\n              Terminal ready | Use Ctrl+C to interrupt | Type 'exit' to close SSH session | No Local Echo\r\n            </span>\r\n          )}\r\n        </div>\r\n        <div>\r\n          {userInfo.name !== 'Unknown' && `Logged in as: ${userInfo.name}`}\r\n          {connectionData?.serverId && ` | Server: ${connectionData.serverName}`}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TerminalPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}